<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spunk.Bet — Casino Games on Bitcoin</title>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="canonical" href="https://spunk.bet">
  <script>if (location.protocol !== 'https:' && location.hostname !== 'localhost') location.replace('https://' + location.host + location.pathname + location.search);</script>
  <meta name="description" content="Play provably fair casino games with Spunk.Bet rune on Bitcoin. Refer friends, earn 500 SPUNK per referral. Top referrers win bonus rewards.">
  <meta property="og:title" content="Spunk.Bet — Casino Games on Bitcoin">
  <meta property="og:description" content="Provably fair Bitcoin casino powered by Spunk.Bet rune. Refer friends &amp; earn 500 SPUNK per signup. First 100 referrers get bonus SPUNK. Join now.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://spunk.bet">
  <meta property="og:image" content="https://spunk.bet/og-image.png">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@SpunkArt13">
  <meta name="twitter:creator" content="@SpunkArt13">
  <meta name="twitter:title" content="Spunk.Bet — Earn SPUNK by Referring Friends">
  <meta name="twitter:description" content="Provably fair Bitcoin casino powered by Spunk.Bet rune. Refer friends, earn 500 SPUNK each. First 100 referrers get bonus rewards.">
  <meta name="twitter:image" content="https://spunk.bet/og-image.png">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --bg: #0a0a0f;
      --surface: #12121a;
      --surface2: #18182a;
      --border: #1e1e2e;
      --text: #e4e4e7;
      --muted: #71717a;
      --accent: #ff5f1f;
      --accent-dim: #cc5500;
      --accent-glow: rgba(255, 95, 31, 0.25);
      --accent-glow2: rgba(255, 95, 31, 0.12);
      --green: #22c55e;
      --red: #ef4444;
      --yellow: #eab308;
      --gold: #f59e0b;
      --purple: #a855f7;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }

    /* NAV */
    nav {
      display: flex; align-items: center; justify-content: space-between;
      padding: 1rem 2rem; border-bottom: 1px solid var(--border);
      position: sticky; top: 0; z-index: 100;
      background: rgba(10,10,15,0.95); backdrop-filter: blur(12px);
    }
    .logo { font-size: 1.4rem; font-weight: 700; letter-spacing: -0.03em; cursor: pointer; }
    .logo span { color: var(--accent); }
    .nav-center { display: flex; gap: 0.25rem; }
    .nav-tab {
      padding: 0.5rem 1rem; border-radius: 8px; font-size: 0.85rem; font-weight: 500;
      color: var(--muted); cursor: pointer; border: none; background: none; transition: all 0.2s;
    }
    .nav-tab:hover { color: var(--text); }
    .nav-tab.active { color: var(--accent); background: var(--accent-glow); }
    .nav-right { display: flex; align-items: center; gap: 0.75rem; }
    .balance-display {
      background: var(--surface); border: 1px solid var(--border); border-radius: 8px;
      padding: 0.4rem 0.8rem; font-size: 0.85rem; font-weight: 600;
    }
    .balance-display span { color: var(--accent); }
    .btn {
      background: var(--accent); color: #fff; border: none; padding: 0.5rem 1.2rem;
      border-radius: 8px; font-size: 0.85rem; font-weight: 600; cursor: pointer; transition: all 0.15s;
    }
    .btn:hover { opacity: 0.9; }
    .btn:active { transform: scale(0.97); }
    .btn:disabled { opacity: 0.4; cursor: not-allowed; }
    .btn-sm { padding: 0.4rem 0.8rem; font-size: 0.8rem; }
    .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text); }
    .btn-outline:hover { border-color: var(--accent); }
    .btn-green { background: var(--green); }
    .btn-red { background: var(--red); }

    /* HAMBURGER MENU */
    .hamburger {
      display: none; background: none; border: none; cursor: pointer; padding: 0.25rem;
      flex-direction: column; gap: 4px; z-index: 110;
    }
    .hamburger span {
      display: block; width: 20px; height: 2px; background: var(--text); border-radius: 2px;
      transition: all 0.3s;
    }
    .hamburger.open span:nth-child(1) { transform: rotate(45deg) translate(4px, 4px); }
    .hamburger.open span:nth-child(2) { opacity: 0; }
    .hamburger.open span:nth-child(3) { transform: rotate(-45deg) translate(4px, -4px); }
    .mobile-menu {
      display: none; position: fixed; top: 57px; left: 0; right: 0; bottom: 0;
      background: rgba(10,10,15,0.98); backdrop-filter: blur(12px); z-index: 99;
      flex-direction: column; align-items: center; justify-content: center; gap: 0.5rem;
    }
    .mobile-menu.show { display: flex; }
    .mobile-menu button {
      background: none; border: 1px solid var(--border); color: var(--text); padding: 1rem 3rem;
      border-radius: 12px; font-size: 1.1rem; font-weight: 600; cursor: pointer;
      transition: all 0.2s; width: 260px; text-align: center;
    }
    .mobile-menu button:hover { border-color: var(--accent); color: var(--accent); }

    /* PAGES */
    .page { display: none; }
    .page.active { display: block; }

    /* HERO */
    .hero { text-align: center; padding: 5rem 2rem 3rem; position: relative; }
    .hero::before {
      content: ''; position: absolute; top: -40%; left: 50%; transform: translateX(-50%);
      width: 600px; height: 600px;
      background: radial-gradient(circle, var(--accent-glow) 0%, transparent 70%); pointer-events: none;
    }
    .hero h1 { font-size: clamp(2.5rem,6vw,4rem); font-weight: 800; letter-spacing: -0.04em; line-height: 1.1; margin-bottom: 1rem; }
    .hero h1 span { color: var(--accent); }
    .hero p { color: var(--muted); font-size: 1.1rem; max-width: 480px; margin: 0 auto 2rem; line-height: 1.6; }
    .hero-rune {
      display: inline-block; background: var(--accent-glow); border: 1px solid var(--accent);
      border-radius: 8px; padding: 0.3rem 0.8rem; font-size: 0.8rem; font-weight: 700;
      color: var(--accent); margin-bottom: 1rem; letter-spacing: 0.05em;
    }

    /* FAUCET */
    .faucet-banner {
      max-width: 900px; margin: 0 auto; padding: 0 2rem 1.5rem;
    }
    .faucet-card {
      background: linear-gradient(135deg, rgba(34,197,94,0.08), rgba(255,95,31,0.08));
      border: 1px solid var(--green); border-radius: 14px;
      padding: 1.25rem 1.5rem; display: flex; align-items: center; justify-content: space-between;
      gap: 1rem; flex-wrap: wrap;
    }
    .faucet-left h3 { font-size: 1rem; font-weight: 700; margin-bottom: 0.2rem; }
    .faucet-left h3 span { color: var(--green); }
    .faucet-left p { font-size: 0.8rem; color: var(--muted); line-height: 1.5; }
    .faucet-btn {
      background: var(--green); color: #fff; border: none; padding: 0.6rem 1.5rem;
      border-radius: 10px; font-size: 0.9rem; font-weight: 700; cursor: pointer;
      transition: all 0.15s; white-space: nowrap;
    }
    .faucet-btn:hover { opacity: 0.9; }
    .faucet-btn:disabled { opacity: 0.4; cursor: not-allowed; }

    /* GAME CARDS */
    .game-grid {
      max-width: 900px; margin: 0 auto; padding: 0 2rem 4rem;
      display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 1rem;
    }
    .game-card {
      background: var(--surface); border: 1px solid var(--border); border-radius: 14px;
      padding: 1.5rem; cursor: pointer; transition: all 0.2s; position: relative; overflow: hidden;
    }
    .game-card:hover { border-color: var(--accent); transform: translateY(-2px); }
    .game-card-icon { font-size: 2.5rem; margin-bottom: 0.75rem; }
    .game-card h3 { font-size: 1.1rem; font-weight: 700; margin-bottom: 0.3rem; }
    .game-card p { color: var(--muted); font-size: 0.8rem; line-height: 1.5; }
    .game-card-edge {
      position: absolute; top: 0.75rem; right: 0.75rem;
      font-size: 0.7rem; color: var(--accent); background: var(--accent-glow);
      padding: 0.2rem 0.5rem; border-radius: 6px; font-weight: 600;
    }

    /* GAME CONTAINER */
    .game-container {
      max-width: 560px; margin: 0 auto; padding: 2rem;
    }
    .game-back {
      color: var(--muted); font-size: 0.85rem; cursor: pointer; margin-bottom: 1.5rem;
      display: inline-flex; align-items: center; gap: 0.3rem; border: none; background: none;
      transition: color 0.2s;
    }
    .game-back:hover { color: var(--text); }
    .game-title { font-size: 1.5rem; font-weight: 700; margin-bottom: 1.5rem; }

    /* BET CONTROLS */
    .bet-controls {
      background: var(--surface); border: 1px solid var(--border); border-radius: 12px;
      padding: 1.25rem; margin-bottom: 1rem;
    }
    .bet-row { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem; }
    .bet-row:last-child { margin-bottom: 0; }
    .bet-label { font-size: 0.8rem; color: var(--muted); min-width: 70px; }
    .bet-input {
      flex: 1; background: var(--bg); border: 1px solid var(--border); border-radius: 8px;
      padding: 0.5rem 0.75rem; color: var(--text); font-size: 0.9rem; font-weight: 600;
      outline: none; transition: border-color 0.2s;
    }
    .bet-input:focus { border-color: var(--accent); }
    .bet-quick { display: flex; gap: 0.25rem; }
    .bet-quick button {
      background: var(--border); border: none; color: var(--muted); padding: 0.3rem 0.5rem;
      border-radius: 6px; font-size: 0.7rem; font-weight: 600; cursor: pointer; transition: all 0.2s;
    }
    .bet-quick button:hover { color: var(--text); background: var(--accent-glow); }

    /* GAME AREA */
    .game-area {
      background: var(--surface); border: 1px solid var(--border); border-radius: 12px;
      padding: 2rem; text-align: center; margin-bottom: 1rem; min-height: 200px;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
    }

    /* RESULT */
    .result {
      padding: 0.75rem 1rem; border-radius: 10px; font-weight: 600; font-size: 0.9rem;
      text-align: center; margin-bottom: 1rem; display: none;
    }
    .result.win { display: block; background: rgba(34,197,94,0.1); border: 1px solid rgba(34,197,94,0.3); color: var(--green); }
    .result.lose { display: block; background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.3); color: var(--red); }

    /* PROVABLY FAIR SEED DISPLAY */
    .seed-display {
      background: var(--bg); border: 1px solid var(--border); border-radius: 8px;
      padding: 0.5rem 0.75rem; margin-top: 0.5rem; font-size: 0.7rem; color: var(--muted);
      font-family: monospace; word-break: break-all; cursor: pointer; transition: border-color 0.2s;
    }
    .seed-display:hover { border-color: var(--accent); }

    /* COIN FLIP */
    .coin {
      width: 120px; height: 120px; border-radius: 50%; display: flex; align-items: center;
      justify-content: center; font-size: 3rem; font-weight: 800; margin: 1rem 0;
      border: 3px solid var(--border); background: var(--surface2); transition: all 0.3s;
    }
    .coin.flipping { animation: coinflip 0.6s ease-in-out; }
    @keyframes coinflip {
      0% { transform: rotateY(0deg) scale(1); }
      50% { transform: rotateY(900deg) scale(0.8); }
      100% { transform: rotateY(1800deg) scale(1); }
    }
    .coin.heads { border-color: var(--accent); color: var(--accent); }
    .coin.tails { border-color: var(--yellow); color: var(--yellow); }
    .flip-choices { display: flex; gap: 0.5rem; margin-top: 0.5rem; }
    .flip-choice {
      padding: 0.5rem 1.5rem; border-radius: 8px; border: 2px solid var(--border);
      background: transparent; color: var(--text); font-weight: 600; font-size: 0.9rem;
      cursor: pointer; transition: all 0.2s;
    }
    .flip-choice:hover { border-color: var(--accent); }
    .flip-choice.selected { border-color: var(--accent); background: var(--accent-glow); color: var(--accent); }

    /* DICE */
    .dice-display { display: flex; gap: 1rem; margin: 1rem 0; }
    .die {
      width: 80px; height: 80px; background: var(--surface2); border: 2px solid var(--border);
      border-radius: 12px; display: flex; align-items: center; justify-content: center;
      font-size: 2rem; font-weight: 800; transition: all 0.3s;
    }
    .die.rolling { animation: shake 0.4s ease-in-out; }
    @keyframes shake {
      0%,100% { transform: rotate(0deg); }
      25% { transform: rotate(-15deg) scale(0.9); }
      75% { transform: rotate(15deg) scale(0.9); }
    }
    .die.hit { border-color: var(--green); color: var(--green); }
    .die.miss { border-color: var(--red); color: var(--red); }
    .dice-slider-wrap { width: 100%; margin: 0.75rem 0; }
    .dice-slider {
      -webkit-appearance: none; width: 100%; height: 6px; border-radius: 3px;
      background: linear-gradient(to right, var(--green) 0%, var(--green) var(--val, 50%), var(--red) var(--val, 50%), var(--red) 100%);
      outline: none; cursor: pointer;
    }
    .dice-slider::-webkit-slider-thumb {
      -webkit-appearance: none; width: 20px; height: 20px; border-radius: 50%;
      background: var(--text); cursor: pointer; border: 2px solid var(--bg);
    }
    .dice-labels { display: flex; justify-content: space-between; font-size: 0.75rem; color: var(--muted); }
    .dice-target { font-size: 1.1rem; font-weight: 700; margin: 0.5rem 0; }
    .dice-target span { color: var(--accent); }
    .dice-multi { font-size: 0.85rem; color: var(--muted); }
    .dice-multi span { color: var(--green); font-weight: 600; }

    /* MINES */
    .mines-grid {
      display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px;
      width: 280px; margin: 0.5rem 0;
    }
    .mine-cell {
      width: 52px; height: 52px; background: var(--surface2); border: 1px solid var(--border);
      border-radius: 8px; display: flex; align-items: center; justify-content: center;
      font-size: 1.2rem; cursor: pointer; transition: all 0.15s; user-select: none;
    }
    .mine-cell:hover:not(.revealed) { border-color: var(--accent); background: var(--accent-glow2); }
    .mine-cell.revealed.safe { background: rgba(34,197,94,0.15); border-color: rgba(34,197,94,0.4); color: var(--green); }
    .mine-cell.revealed.bomb { background: rgba(239,68,68,0.15); border-color: rgba(239,68,68,0.4); color: var(--red); }
    .mine-cell.revealed.shown { background: rgba(113,113,122,0.1); border-color: var(--border); color: var(--muted); }
    .mines-info { display: flex; gap: 1.5rem; margin: 0.75rem 0; font-size: 0.85rem; }
    .mines-info span { color: var(--accent); font-weight: 600; }
    .mines-count-row { display: flex; align-items: center; gap: 0.5rem; }
    .mines-count-btn {
      width: 28px; height: 28px; border-radius: 6px; border: 1px solid var(--border);
      background: var(--surface2); color: var(--text); font-weight: 700; cursor: pointer;
      display: flex; align-items: center; justify-content: center; font-size: 0.85rem;
    }
    .mines-count-btn:hover { border-color: var(--accent); }

    /* CRASH */
    .crash-graph {
      width: 100%; height: 200px; background: var(--bg); border-radius: 10px;
      border: 1px solid var(--border); position: relative; overflow: hidden; margin: 0.5rem 0;
    }
    .crash-canvas { width: 100%; height: 100%; }
    .crash-multi {
      font-size: 3rem; font-weight: 800; letter-spacing: -0.03em;
      transition: color 0.2s;
    }
    .crash-multi.live { color: var(--green); }
    .crash-multi.crashed { color: var(--red); }
    .crash-multi.cashed { color: var(--accent); }
    .crash-status { font-size: 0.85rem; color: var(--muted); margin-top: 0.25rem; }

    /* HISTORY */
    .history-list { display: flex; flex-direction: column; gap: 0.35rem; }
    .history-item {
      display: flex; justify-content: space-between; align-items: center;
      font-size: 0.8rem; padding: 0.4rem 0; border-bottom: 1px solid var(--border);
    }
    .history-game { color: var(--muted); }
    .history-result { font-weight: 600; }
    .history-result.win { color: var(--green); }
    .history-result.lose { color: var(--red); }

    /* PROVABLY FAIR PAGE */
    .fair-container { max-width: 620px; margin: 0 auto; padding: 2rem; }
    .fair-container h2 { font-size: 1.3rem; font-weight: 700; margin-bottom: 0.5rem; }
    .fair-container h3 { font-size: 1rem; font-weight: 700; margin: 1.5rem 0 0.5rem; color: var(--accent); }
    .fair-container p { color: var(--muted); font-size: 0.85rem; line-height: 1.7; margin-bottom: 0.75rem; }
    .fair-container code {
      background: var(--surface); border: 1px solid var(--border); border-radius: 6px;
      padding: 0.15rem 0.4rem; font-size: 0.8rem; color: var(--accent);
    }
    .fair-card {
      background: var(--surface); border: 1px solid var(--border); border-radius: 12px;
      padding: 1.25rem; margin: 1rem 0;
    }
    .fair-card label { display: block; font-size: 0.8rem; color: var(--muted); margin-bottom: 0.3rem; }
    .fair-card input, .fair-card textarea {
      width: 100%; background: var(--bg); border: 1px solid var(--border); border-radius: 8px;
      padding: 0.5rem 0.75rem; color: var(--text); font-size: 0.85rem; font-family: monospace;
      outline: none; margin-bottom: 0.75rem; resize: vertical;
    }
    .fair-card input:focus, .fair-card textarea:focus { border-color: var(--accent); }
    .verify-result {
      padding: 0.75rem; border-radius: 8px; font-size: 0.85rem; font-weight: 600; display: none;
    }
    .verify-result.pass { display: block; background: rgba(34,197,94,0.1); border: 1px solid rgba(34,197,94,0.3); color: var(--green); }
    .verify-result.fail { display: block; background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.3); color: var(--red); }
    .shield-icon {
      display: inline-flex; align-items: center; gap: 0.3rem; background: rgba(34,197,94,0.1);
      border: 1px solid rgba(34,197,94,0.3); border-radius: 8px; padding: 0.3rem 0.7rem;
      font-size: 0.8rem; font-weight: 600; color: var(--green); margin-bottom: 1rem;
    }

    /* WALLETS PAGE */
    .wallets-container { max-width: 620px; margin: 0 auto; padding: 2rem; }
    .wallets-container h2 { font-size: 1.3rem; font-weight: 700; margin-bottom: 0.5rem; }
    .wallets-container p { color: var(--muted); font-size: 0.85rem; line-height: 1.7; margin-bottom: 0.75rem; }
    .wallet-card {
      background: var(--surface); border: 1px solid var(--border); border-radius: 14px;
      padding: 1.5rem; margin-bottom: 1.25rem;
    }
    .wallet-card h3 { font-size: 1rem; font-weight: 700; margin-bottom: 0.3rem; display: flex; align-items: center; gap: 0.4rem; }
    .wallet-card .wallet-purpose { color: var(--muted); font-size: 0.8rem; margin-bottom: 1rem; line-height: 1.5; }
    .wallet-addr-box {
      display: flex; align-items: center; gap: 0.5rem; background: var(--bg);
      border: 1px solid var(--border); border-radius: 8px; padding: 0.6rem 0.75rem;
    }
    .wallet-addr-box input {
      flex: 1; background: none; border: none; color: var(--text); font-size: 0.75rem;
      font-family: monospace; outline: none;
    }
    .wallet-addr-box button {
      background: var(--accent); border: none; color: #fff; padding: 0.3rem 0.6rem;
      border-radius: 6px; font-size: 0.75rem; font-weight: 600; cursor: pointer;
      white-space: nowrap;
    }
    .wallet-tag {
      display: inline-block; padding: 0.15rem 0.5rem; border-radius: 6px;
      font-size: 0.7rem; font-weight: 700; letter-spacing: 0.03em;
    }
    .wallet-tag.rune { background: rgba(255,95,31,0.15); color: var(--accent); }
    .wallet-tag.btc { background: rgba(245,158,11,0.15); color: var(--gold); }
    .wallet-tag.ord { background: rgba(168,85,247,0.15); color: var(--purple); }

    /* FOOTER */
    footer {
      border-top: 1px solid var(--border); padding: 2rem; text-align: center;
      color: var(--muted); font-size: 0.75rem; margin-top: 3rem;
    }
    footer a { color: var(--muted); text-decoration: none; }
    footer a:hover { color: var(--text); }
    .footer-links { display: flex; justify-content: center; gap: 1.5rem; margin-bottom: 0.75rem; flex-wrap: wrap; }
    .footer-links a { font-weight: 500; }

    /* WALLET */
    .wallet-btn {
      background: var(--accent); color: #fff; border: none; padding: 0.5rem 1.2rem;
      border-radius: 8px; font-size: 0.85rem; font-weight: 600; cursor: pointer;
      transition: all 0.15s; display: flex; align-items: center; gap: 0.4rem;
    }
    .wallet-btn:hover { opacity: 0.9; }
    .wallet-btn.connected {
      background: var(--surface); border: 1px solid var(--border); color: var(--text);
      font-size: 0.8rem;
    }
    .wallet-btn.connected:hover { border-color: var(--accent); }
    .wallet-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--green); }
    .wallet-modal-overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 200;
      display: none; align-items: center; justify-content: center;
      backdrop-filter: blur(4px);
    }
    .wallet-modal-overlay.show { display: flex; }
    .wallet-modal {
      background: var(--surface); border: 1px solid var(--border); border-radius: 16px;
      padding: 2rem; width: 420px; max-width: 90vw; text-align: center;
    }
    .wallet-modal h3 { font-size: 1.1rem; font-weight: 700; margin-bottom: 0.5rem; }
    .wallet-modal p { color: var(--muted); font-size: 0.85rem; margin-bottom: 1.5rem; }
    .wallet-option {
      display: flex; align-items: center; gap: 1rem; padding: 1rem; border: 1px solid var(--border);
      border-radius: 12px; cursor: pointer; transition: all 0.2s; margin-bottom: 0.5rem;
      background: var(--bg);
    }
    .wallet-option:hover { border-color: var(--accent); }
    .wallet-option-icon {
      width: 40px; height: 40px; border-radius: 10px; background: #ee7b30;
      display: flex; align-items: center; justify-content: center; font-weight: 800;
      font-size: 1.1rem; color: #fff; flex-shrink: 0;
    }
    .wallet-option-info { text-align: left; }
    .wallet-option-name { font-weight: 600; font-size: 0.95rem; }
    .wallet-option-desc { color: var(--muted); font-size: 0.75rem; margin-top: 0.1rem; }
    .wallet-modal-close {
      margin-top: 1rem; color: var(--muted); font-size: 0.8rem; cursor: pointer;
      background: none; border: none; transition: color 0.2s;
    }
    .wallet-modal-close:hover { color: var(--text); }
    .wallet-info {
      background: var(--surface); border: 1px solid var(--border); border-radius: 10px;
      padding: 1rem; margin-bottom: 1rem; text-align: left;
    }
    .wallet-info-row {
      display: flex; justify-content: space-between; align-items: center;
      font-size: 0.8rem; margin-bottom: 0.4rem;
    }
    .wallet-info-row:last-child { margin-bottom: 0; }
    .wallet-info-label { color: var(--muted); }
    .wallet-info-value { font-weight: 600; font-family: monospace; font-size: 0.75rem; }

    /* WELCOME TOAST */
    .toast {
      position: fixed; top: -100px; left: 50%; transform: translateX(-50%);
      background: var(--surface); border: 1px solid var(--accent); border-radius: 12px;
      padding: 1rem 1.5rem; z-index: 300; font-size: 0.9rem; font-weight: 600;
      box-shadow: 0 8px 32px rgba(0,0,0,0.4); transition: top 0.4s ease;
      max-width: 90vw; text-align: center;
    }
    .toast.show { top: 1rem; }
    .toast .toast-amount { color: var(--accent); }

    /* SHARE & EARN BUTTON */
    .share-btn {
      background: transparent; border: 1px solid var(--border); color: var(--text);
      padding: 0.4rem 0.8rem; border-radius: 8px; font-size: 0.8rem; font-weight: 600;
      cursor: pointer; transition: all 0.2s; display: none; align-items: center; gap: 0.3rem;
    }
    .share-btn:hover { border-color: var(--accent); color: var(--accent); }
    .share-btn.visible { display: flex; }

    /* REFERRAL MODAL */
    .referral-modal-content { text-align: left; }
    .referral-link-box {
      display: flex; align-items: center; gap: 0.5rem; background: var(--bg);
      border: 1px solid var(--border); border-radius: 8px; padding: 0.6rem 0.75rem;
      margin: 0.75rem 0;
    }
    .referral-link-box input {
      flex: 1; background: none; border: none; color: var(--text); font-size: 0.8rem;
      font-family: monospace; outline: none;
    }
    .referral-link-box button {
      background: var(--accent); border: none; color: #fff; padding: 0.3rem 0.6rem;
      border-radius: 6px; font-size: 0.75rem; font-weight: 600; cursor: pointer;
      white-space: nowrap;
    }
    .referral-stat {
      display: flex; justify-content: space-between; align-items: center;
      padding: 0.5rem 0; border-bottom: 1px solid var(--border); font-size: 0.85rem;
    }
    .referral-stat:last-child { border-bottom: none; }
    .referral-stat-label { color: var(--muted); }
    .referral-stat-value { font-weight: 700; color: var(--accent); }

    /* TIER BADGES */
    .tier-badge {
      display: inline-block; padding: 0.15rem 0.5rem; border-radius: 6px;
      font-size: 0.7rem; font-weight: 700; letter-spacing: 0.03em;
    }
    .tier-badge.starter { background: rgba(113,113,122,0.2); color: var(--muted); }
    .tier-badge.bronze { background: rgba(234,179,8,0.15); color: var(--yellow); }
    .tier-badge.silver { background: rgba(168,162,158,0.2); color: #a8a29e; }
    .tier-badge.gold { background: rgba(245,158,11,0.2); color: var(--gold); }
    .tier-badge.vip { background: rgba(168,85,247,0.2); color: var(--purple); }

    /* LEADERBOARD */
    .leaderboard-section {
      max-width: 560px; margin: 0 auto 2rem; padding: 0 2rem;
    }
    .leaderboard-card {
      background: var(--surface); border: 1px solid var(--border); border-radius: 14px;
      padding: 1.25rem; margin-top: 1rem;
    }
    .leaderboard-card h3 {
      font-size: 0.95rem; font-weight: 700; margin-bottom: 0.75rem;
      display: flex; align-items: center; gap: 0.4rem;
    }
    .leaderboard-entry {
      display: flex; align-items: center; gap: 0.75rem;
      padding: 0.5rem 0; border-bottom: 1px solid var(--border); font-size: 0.82rem;
    }
    .leaderboard-entry:last-child { border-bottom: none; }
    .leaderboard-rank {
      width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center;
      justify-content: center; font-weight: 800; font-size: 0.75rem; flex-shrink: 0;
    }
    .leaderboard-rank.r1 { background: rgba(245,158,11,0.2); color: var(--gold); }
    .leaderboard-rank.r2 { background: rgba(168,162,158,0.2); color: #a8a29e; }
    .leaderboard-rank.r3 { background: rgba(234,179,8,0.15); color: var(--yellow); }
    .leaderboard-rank.r4 { background: var(--border); color: var(--muted); }
    .leaderboard-addr { flex: 1; font-family: monospace; font-size: 0.75rem; color: var(--muted); }
    .leaderboard-count { font-weight: 700; color: var(--accent); }
    .leaderboard-empty { color: var(--muted); font-size: 0.8rem; text-align: center; padding: 1rem; }

    /* FIRST 100 BANNER */
    .first100-banner {
      max-width: 900px; margin: 0 auto; padding: 0 2rem 1.5rem;
    }
    .first100-card {
      background: linear-gradient(135deg, rgba(255,95,31,0.08), rgba(168,85,247,0.08));
      border: 1px solid var(--accent); border-radius: 14px;
      padding: 1.25rem 1.5rem; display: flex; align-items: center; justify-content: space-between;
      gap: 1rem; flex-wrap: wrap;
    }
    .first100-left h3 { font-size: 1rem; font-weight: 700; margin-bottom: 0.2rem; }
    .first100-left h3 span { color: var(--accent); }
    .first100-left p { font-size: 0.8rem; color: var(--muted); line-height: 1.5; }
    .first100-counter {
      background: var(--surface); border: 1px solid var(--border); border-radius: 10px;
      padding: 0.6rem 1rem; text-align: center; min-width: 100px;
    }
    .first100-counter .count { font-size: 1.5rem; font-weight: 800; color: var(--accent); }
    .first100-counter .label { font-size: 0.65rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.08em; }

    /* TIERS DISPLAY */
    .tiers-section {
      margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid var(--border);
    }
    .tiers-grid {
      display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.4rem; margin-top: 0.5rem;
    }
    .tier-card {
      background: var(--bg); border: 1px solid var(--border); border-radius: 8px;
      padding: 0.5rem; text-align: center; font-size: 0.7rem;
    }
    .tier-card .tier-name { font-weight: 700; margin-bottom: 0.15rem; }
    .tier-card .tier-req { color: var(--muted); }
    .tier-card .tier-reward { color: var(--green); font-weight: 600; margin-top: 0.15rem; }
    .tier-card.active { border-color: var(--accent); background: var(--accent-glow2); }

    @media (max-width: 640px) {
      nav { padding: 0.75rem 1rem; }
      .nav-center { display: none; }
      .hamburger { display: flex; }
      .game-container { padding: 1.5rem 1rem; }
      .game-grid { padding: 0 1rem 3rem; }
      .hero { padding: 3rem 1.5rem 2rem; }
      .mine-cell { width: 44px; height: 44px; font-size: 1rem; }
      .mines-grid { width: 240px; gap: 4px; }
      .first100-card { flex-direction: column; text-align: center; }
      .faucet-card { flex-direction: column; text-align: center; }
      .tiers-grid { grid-template-columns: repeat(2, 1fr); }
      .nav-right { gap: 0.5rem; }
      .share-btn { display: none !important; }
      .balance-display { font-size: 0.75rem; padding: 0.3rem 0.5rem; }
    }
  </style>
</head>
<body>

<nav>
  <div class="logo" onclick="showPage('home')">spunk<span>.bet</span></div>
  <div class="nav-center">
    <button class="nav-tab active" onclick="showPage('home')">Games</button>
    <button class="nav-tab" onclick="showPage('leaderboard-page')">Leaderboard</button>
    <button class="nav-tab" onclick="showPage('history-page')">History</button>
    <button class="nav-tab" onclick="showPage('wallets-page')">Wallets</button>
    <button class="nav-tab" onclick="showPage('fair-page')">Provably Fair</button>
  </div>
  <button class="hamburger" id="hamburger-btn" onclick="toggleMobileMenu()">
    <span></span><span></span><span></span>
  </button>
  <div class="nav-right">
    <div class="balance-display"><span id="balance-display">0</span> SPUNK</div>
    <button class="share-btn" id="share-btn" onclick="openReferralModal()">Share &amp; Earn</button>
    <button class="wallet-btn" id="wallet-btn" onclick="handleWalletClick()">Connect Wallet</button>
  </div>
</nav>

<!-- Mobile Menu -->
<div class="mobile-menu" id="mobile-menu">
  <button onclick="showPage('home'); toggleMobileMenu()">Games</button>
  <button onclick="showPage('leaderboard-page'); toggleMobileMenu()">Leaderboard</button>
  <button onclick="showPage('history-page'); toggleMobileMenu()">History</button>
  <button onclick="showPage('wallets-page'); toggleMobileMenu()">Wallets</button>
  <button onclick="showPage('fair-page'); toggleMobileMenu()">Provably Fair</button>
  <button onclick="openReferralModal(); toggleMobileMenu()" id="mobile-share-btn" style="display:none;">Share &amp; Earn</button>
</div>

<!-- Welcome Toast -->
<div class="toast" id="welcome-toast"></div>

<!-- Wallet Modal -->
<div class="wallet-modal-overlay" id="wallet-modal">
  <div class="wallet-modal">
    <h3>Connect Wallet</h3>
    <p>Connect your Bitcoin wallet to play with Spunk.Bet rune</p>
    <div class="wallet-option" onclick="connectXverse()">
      <div class="wallet-option-icon" style="background:#ee7b30;">X</div>
      <div class="wallet-option-info">
        <div class="wallet-option-name">Xverse</div>
        <div class="wallet-option-desc">Bitcoin, Ordinals, Runes & Stacks</div>
      </div>
    </div>
    <div class="wallet-option" onclick="connectUnisat()">
      <div class="wallet-option-icon" style="background:#000;border:1px solid #333;">U</div>
      <div class="wallet-option-info">
        <div class="wallet-option-name">Unisat</div>
        <div class="wallet-option-desc">Bitcoin, Ordinals, BRC-20 & Runes</div>
      </div>
    </div>
    <div class="wallet-option" onclick="connectMagicEden()">
      <div class="wallet-option-icon" style="background:#e42575;">M</div>
      <div class="wallet-option-info">
        <div class="wallet-option-name">Magic Eden</div>
        <div class="wallet-option-desc">Bitcoin, Ordinals & Runes</div>
      </div>
    </div>
    <div id="wallet-install-hint" style="display:none; margin-top:0.75rem; padding:0.75rem; background:var(--bg); border-radius:8px; border:1px solid var(--border);">
      <p style="font-size:0.8rem; color:var(--muted); margin:0;" id="wallet-install-text">Wallet not detected. Install the wallet extension and refresh.</p>
    </div>
    <button class="wallet-modal-close" onclick="closeWalletModal()">Cancel</button>
  </div>
</div>

<!-- Wallet Details Modal -->
<div class="wallet-modal-overlay" id="wallet-details-modal">
  <div class="wallet-modal">
    <h3>Wallet Connected</h3>
    <div class="wallet-info" id="wallet-info-details"></div>
    <div id="wallet-tier-display" style="margin-bottom:1rem;"></div>
    <button class="btn" style="width:100%; margin-bottom:0.5rem;" onclick="disconnectWallet()">Disconnect</button>
    <button class="wallet-modal-close" onclick="closeWalletDetails()">Close</button>
  </div>
</div>

<!-- Referral Modal -->
<div class="wallet-modal-overlay" id="referral-modal">
  <div class="wallet-modal">
    <h3>Share &amp; Earn SPUNK</h3>
    <p>Earn 500 SPUNK for every friend who connects. First 100 referrers get bonus rewards!</p>
    <div class="referral-modal-content">
      <div style="font-size:0.8rem; color:var(--muted); margin-bottom:0.25rem;">Your referral link</div>
      <div class="referral-link-box">
        <input type="text" id="referral-link-input" readonly>
        <button onclick="copyReferralLink()">Copy</button>
      </div>
      <div class="referral-stat">
        <span class="referral-stat-label">Your code</span>
        <span class="referral-stat-value" id="referral-code">&mdash;</span>
      </div>
      <div class="referral-stat">
        <span class="referral-stat-label">Friends referred</span>
        <span class="referral-stat-value" id="referral-count">0</span>
      </div>
      <div class="referral-stat">
        <span class="referral-stat-label">Your tier</span>
        <span id="referral-tier"></span>
      </div>
      <div class="referral-stat">
        <span class="referral-stat-label">SPUNK earned</span>
        <span class="referral-stat-value" id="referral-earned">0</span>
      </div>
      <div class="tiers-section">
        <div style="font-size:0.75rem; color:var(--muted); font-weight:600;">REFERRAL TIERS</div>
        <div class="tiers-grid" id="tiers-grid"></div>
      </div>
    </div>
    <button class="wallet-modal-close" onclick="closeReferralModal()">Close</button>
  </div>
</div>

<!-- HOME -->
<div id="home" class="page active">
  <section class="hero">
    <div class="hero-rune">Spunk.Bet RUNE</div>
    <h1>Play. Bet. <span>Win.</span></h1>
    <p>Provably fair casino games powered by the Spunk.Bet rune on Bitcoin. No accounts, no KYC. Connect and play.</p>
    <div class="shield-icon">Provably Fair</div>
  </section>

  <!-- Faucet Banner -->
  <div class="faucet-banner" id="faucet-banner">
    <div class="faucet-card">
      <div class="faucet-left">
        <h3>Need SPUNK to play? <span>Claim free tokens</span></h3>
        <p>Get 10,000 free SPUNK tokens to try all games. Claim once every 24 hours.</p>
      </div>
      <button class="faucet-btn" id="faucet-btn" onclick="claimFaucet()">Claim 10,000 SPUNK</button>
    </div>
  </div>

  <!-- First 100 Referrers Banner -->
  <div class="first100-banner" id="first100-banner">
    <div class="first100-card">
      <div class="first100-left">
        <h3>First 100 Referrers Get <span>Bonus SPUNK</span></h3>
        <p>Share your referral link and be among the first 100 to refer a friend. Early referrers earn 2x bonus rewards!</p>
      </div>
      <div class="first100-counter">
        <div class="count" id="first100-count">100</div>
        <div class="label">Spots Left</div>
      </div>
    </div>
  </div>

  <div class="game-grid">
    <div class="game-card" onclick="openGame('coinflip')">
      <div class="game-card-edge">1.98x</div>
      <div class="game-card-icon">&#x1FA99;</div>
      <h3>Coin Flip</h3>
      <p>Heads or tails. Classic 50/50 with 1.98x payout. Fast and simple.</p>
    </div>
    <div class="game-card" onclick="openGame('dice')">
      <div class="game-card-edge">1.01-99x</div>
      <div class="game-card-icon">&#127922;</div>
      <h3>Dice</h3>
      <p>Set your target. Roll under to win. Adjust risk and reward with the slider.</p>
    </div>
    <div class="game-card" onclick="openGame('mines')">
      <div class="game-card-edge">Up to 24x</div>
      <div class="game-card-icon">&#128163;</div>
      <h3>Mines</h3>
      <p>Navigate a 5x5 grid. Reveal safe tiles to multiply your bet. Hit a mine and lose it all.</p>
    </div>
    <div class="game-card" onclick="openGame('crash')">
      <div class="game-card-edge">&#8734;x</div>
      <div class="game-card-icon">&#128200;</div>
      <h3>Crash</h3>
      <p>Watch the multiplier rise. Cash out before it crashes. How far will you push it?</p>
    </div>
  </div>
</div>

<!-- COIN FLIP -->
<div id="coinflip" class="page">
  <div class="game-container">
    <button class="game-back" onclick="showPage('home')">&larr; Back to games</button>
    <div class="game-title">&#x1FA99; Coin Flip</div>
    <div class="bet-controls">
      <div class="bet-row">
        <span class="bet-label">Bet (SPUNK)</span>
        <input type="number" class="bet-input" id="cf-bet" value="100" min="100">
        <div class="bet-quick">
          <button onclick="setBet('cf-bet','half')">&#189;</button>
          <button onclick="setBet('cf-bet','double')">2x</button>
          <button onclick="setBet('cf-bet','max')">Max</button>
        </div>
      </div>
      <div class="bet-row">
        <span class="bet-label">Pick</span>
        <div class="flip-choices">
          <button class="flip-choice selected" id="cf-heads" onclick="pickSide('heads')">Heads</button>
          <button class="flip-choice" id="cf-tails" onclick="pickSide('tails')">Tails</button>
        </div>
      </div>
    </div>
    <div id="cf-result" class="result"></div>
    <div class="game-area">
      <div class="coin" id="cf-coin">?</div>
      <div style="margin-top:0.5rem; font-size:0.8rem; color:var(--muted)">Payout: 1.98x</div>
      <div class="seed-display" id="cf-seed" onclick="copySeed('cf-seed')" title="Click to copy seed hash"></div>
    </div>
    <button class="btn" style="width:100%; padding:0.75rem;" onclick="flipCoin()">Flip Coin</button>
  </div>
</div>

<!-- DICE -->
<div id="dice" class="page">
  <div class="game-container">
    <button class="game-back" onclick="showPage('home')">&larr; Back to games</button>
    <div class="game-title">&#127922; Dice</div>
    <div class="bet-controls">
      <div class="bet-row">
        <span class="bet-label">Bet (SPUNK)</span>
        <input type="number" class="bet-input" id="dice-bet" value="100" min="100">
        <div class="bet-quick">
          <button onclick="setBet('dice-bet','half')">&#189;</button>
          <button onclick="setBet('dice-bet','double')">2x</button>
          <button onclick="setBet('dice-bet','max')">Max</button>
        </div>
      </div>
    </div>
    <div id="dice-result" class="result"></div>
    <div class="game-area">
      <div class="dice-target">Roll under <span id="dice-target-val">50</span> to win</div>
      <div class="dice-display">
        <div class="die" id="dice-die">&#8212;</div>
      </div>
      <div class="dice-slider-wrap">
        <input type="range" class="dice-slider" id="dice-slider" min="5" max="95" value="50" oninput="updateDiceSlider()">
        <div class="dice-labels"><span>5</span><span>50</span><span>95</span></div>
      </div>
      <div class="dice-multi">Win chance: <span id="dice-chance">49%</span> &middot; Payout: <span id="dice-payout" style="color:var(--green);font-weight:600">2.00x</span></div>
      <div class="seed-display" id="dice-seed" onclick="copySeed('dice-seed')" title="Click to copy seed hash"></div>
    </div>
    <button class="btn" style="width:100%; padding:0.75rem;" onclick="rollDice()">Roll Dice</button>
  </div>
</div>

<!-- MINES -->
<div id="mines" class="page">
  <div class="game-container">
    <button class="game-back" onclick="showPage('home')">&larr; Back to games</button>
    <div class="game-title">&#128163; Mines</div>
    <div class="bet-controls">
      <div class="bet-row">
        <span class="bet-label">Bet (SPUNK)</span>
        <input type="number" class="bet-input" id="mines-bet" value="100" min="100">
        <div class="bet-quick">
          <button onclick="setBet('mines-bet','half')">&#189;</button>
          <button onclick="setBet('mines-bet','double')">2x</button>
          <button onclick="setBet('mines-bet','max')">Max</button>
        </div>
      </div>
      <div class="bet-row">
        <span class="bet-label">Mines</span>
        <div class="mines-count-row">
          <button class="mines-count-btn" onclick="changeMines(-1)">-</button>
          <span id="mines-count" style="font-weight:700;min-width:24px;text-align:center">3</span>
          <button class="mines-count-btn" onclick="changeMines(1)">+</button>
        </div>
      </div>
    </div>
    <div id="mines-result" class="result"></div>
    <div class="game-area" style="padding:1.25rem;">
      <div class="mines-grid" id="mines-grid"></div>
      <div class="mines-info">
        <div>Revealed: <span id="mines-revealed">0</span></div>
        <div>Multiplier: <span id="mines-multi">1.00x</span></div>
        <div>Profit: <span id="mines-profit">+0</span> SPUNK</div>
      </div>
      <div class="seed-display" id="mines-seed" onclick="copySeed('mines-seed')" title="Click to copy seed hash" style="width:100%;"></div>
    </div>
    <div style="display:flex;gap:0.5rem;">
      <button class="btn" style="flex:1; padding:0.75rem;" id="mines-start-btn" onclick="startMines()">Start Game</button>
      <button class="btn btn-green" style="flex:1; padding:0.75rem; display:none;" id="mines-cashout-btn" onclick="cashoutMines()">Cash Out</button>
    </div>
  </div>
</div>

<!-- CRASH -->
<div id="crash" class="page">
  <div class="game-container">
    <button class="game-back" onclick="showPage('home')">&larr; Back to games</button>
    <div class="game-title">&#128200; Crash</div>
    <div class="bet-controls">
      <div class="bet-row">
        <span class="bet-label">Bet (SPUNK)</span>
        <input type="number" class="bet-input" id="crash-bet" value="100" min="100">
        <div class="bet-quick">
          <button onclick="setBet('crash-bet','half')">&#189;</button>
          <button onclick="setBet('crash-bet','double')">2x</button>
          <button onclick="setBet('crash-bet','max')">Max</button>
        </div>
      </div>
    </div>
    <div id="crash-result" class="result"></div>
    <div class="game-area" style="padding:1.25rem;">
      <div class="crash-graph"><canvas class="crash-canvas" id="crash-canvas"></canvas></div>
      <div class="crash-multi" id="crash-multi">1.00x</div>
      <div class="crash-status" id="crash-status">Place your bet and launch</div>
      <div class="seed-display" id="crash-seed" onclick="copySeed('crash-seed')" title="Click to copy seed hash" style="width:100%;"></div>
    </div>
    <div style="display:flex;gap:0.5rem;">
      <button class="btn" style="flex:1; padding:0.75rem;" id="crash-start-btn" onclick="startCrash()">Launch</button>
      <button class="btn btn-green" style="flex:1; padding:0.75rem; display:none;" id="crash-cashout-btn" onclick="cashoutCrash()">Cash Out</button>
    </div>
  </div>
</div>

<!-- LEADERBOARD PAGE -->
<div id="leaderboard-page" class="page">
  <div class="game-container">
    <h2 style="font-size:1.3rem;font-weight:700;margin-bottom:0.25rem;">Referral Leaderboard</h2>
    <p style="color:var(--muted);font-size:0.85rem;margin-bottom:1.5rem;">Top referrers earn bonus Spunk.Bet rewards</p>
    <div class="leaderboard-card">
      <h3>Top Referrers</h3>
      <div id="leaderboard-list"></div>
    </div>
    <div class="leaderboard-card" style="margin-top:1rem;">
      <h3>Tier Rewards</h3>
      <div class="tiers-grid" id="leaderboard-tiers"></div>
    </div>
  </div>
</div>

<!-- HISTORY PAGE -->
<div id="history-page" class="page">
  <div class="game-container">
    <h2 style="font-size:1.3rem;font-weight:700;margin-bottom:1rem;">Bet History</h2>
    <div id="history-full-list" class="history-list" style="font-size:0.85rem;">
      <div style="color:var(--muted);text-align:center;padding:2rem;">No bets yet. Go play!</div>
    </div>
  </div>
</div>

<!-- WALLETS PAGE -->
<div id="wallets-page" class="page">
  <div class="wallets-container">
    <h2>Spunk.Bet Wallets</h2>
    <p>These are the official Spunk.Bet wallets. Send runes, BTC, or ordinals to fund rewards, prizes, and payouts for players.</p>

    <div class="wallet-card">
      <h3>House Wallet <span class="wallet-tag rune">RUNES</span> <span class="wallet-tag btc">BTC</span></h3>
      <div class="wallet-purpose">Funds SPUNK rune payouts for faucet claims, referral rewards, and game winnings. Also accepts BTC for operational costs.</div>
      <div class="wallet-addr-box">
        <input type="text" value="bc1pkepg42ctsvsxk499qu02qqyyz88gwjchnjpsu22wmng9rhpfv3jqw2t2hm" readonly id="house-wallet-addr">
        <button onclick="copyWalletAddr('house-wallet-addr')">Copy</button>
      </div>
    </div>

    <div class="wallet-card">
      <h3>Prize Wallet <span class="wallet-tag ord">ORDINALS</span></h3>
      <div class="wallet-purpose">Holds ordinal inscriptions for giveaways, tournament prizes, and special events. Ordinals sent here will be used as player rewards.</div>
      <div class="wallet-addr-box">
        <input type="text" value="bc1p27l6s82w5dek9yffjtlyj58ue2sndxm6zszpcz9zcwqpd4v86n9s5l37xm" readonly id="prize-wallet-addr">
        <button onclick="copyWalletAddr('prize-wallet-addr')">Copy</button>
      </div>
    </div>

    <div style="background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:1.25rem;margin-top:1rem;">
      <h3 style="font-size:0.9rem;font-weight:700;margin-bottom:0.5rem;color:var(--green);">Transparency</h3>
      <p style="font-size:0.8rem;color:var(--muted);line-height:1.6;margin:0;">All wallet balances are publicly verifiable on-chain. These are taproot (P2TR) addresses on Bitcoin mainnet. You can verify balances using any Bitcoin block explorer.</p>
    </div>
  </div>
</div>

<!-- PROVABLY FAIR PAGE -->
<div id="fair-page" class="page">
  <div class="fair-container">
    <div class="shield-icon">Provably Fair</div>
    <h2>How We Prove Every Game is Fair</h2>
    <p>Every bet on Spunk.bet uses a provably fair system. Before each game, we generate a seed that determines the outcome. You can verify any bet after it's played.</p>

    <h3>How It Works</h3>
    <p><strong>1. Before the game:</strong> A random server seed is generated and its SHA-256 hash is shown to you. This commits us to the outcome before you bet.</p>
    <p><strong>2. You play:</strong> Your client seed (generated from your session) is combined with the server seed to produce the game result.</p>
    <p><strong>3. After the game:</strong> The raw server seed is revealed. You can hash it yourself to verify it matches the hash shown before the game.</p>

    <h3>The Math</h3>
    <p>The game result is derived from: <code>HMAC-SHA256(serverSeed, clientSeed + nonce)</code>. The first 8 hex characters are converted to a number between 0 and 1, which maps to the game outcome (coin side, dice roll, mine positions, crash point).</p>

    <h3>Verify a Bet</h3>
    <div class="fair-card">
      <label>Server Seed (revealed after game)</label>
      <input type="text" id="verify-server" placeholder="Paste the revealed server seed">
      <label>Server Seed Hash (shown before game)</label>
      <input type="text" id="verify-hash" placeholder="Paste the hash that was displayed">
      <label>Client Seed</label>
      <input type="text" id="verify-client" placeholder="Your client seed">
      <label>Nonce</label>
      <input type="number" id="verify-nonce" placeholder="Game number" value="0">
      <button class="btn" style="width:100%;" onclick="verifyBet()">Verify</button>
      <div class="verify-result" id="verify-result" style="margin-top:0.75rem;"></div>
    </div>

    <h3>Your Current Seeds</h3>
    <div class="fair-card">
      <label>Client Seed (yours)</label>
      <input type="text" id="my-client-seed" readonly>
      <label>Next Server Seed Hash (our commitment)</label>
      <input type="text" id="my-server-hash" readonly>
      <label>Games Played (nonce)</label>
      <input type="text" id="my-nonce" readonly>
      <button class="btn btn-outline" style="width:100%; margin-top:0.25rem;" onclick="rotateClientSeed()">Rotate Client Seed</button>
    </div>
  </div>
</div>

<footer>
  <div class="footer-links">
    <a href="javascript:showPage('wallets-page')">Wallets</a>
    <a href="javascript:showPage('fair-page')">Provably Fair</a>
    <a href="https://x.com/SpunkArt13" target="_blank">@SpunkArt13</a>
  </div>
  <p>spunk.bet &mdash; powered by Spunk.Bet rune on Bitcoin</p>
  <p style="margin-top:0.5rem; opacity:0.5;">Playing with Spunk.Bet rune tokens &middot; All games are provably fair</p>
</footer>

<script>
// ===== PROVABLY FAIR SYSTEM =====
// Uses SHA-256 HMAC for seed-based outcome generation
// Server seed is committed (hashed) before each game, revealed after

function generateRandomHex(bytes) {
  const arr = new Uint8Array(bytes);
  crypto.getRandomValues(arr);
  return Array.from(arr, b => b.toString(16).padStart(2, '0')).join('');
}

async function sha256(message) {
  const encoder = new TextEncoder();
  const data = encoder.encode(message);
  const hashBuffer = await crypto.subtle.digest('SHA-256', data);
  return Array.from(new Uint8Array(hashBuffer), b => b.toString(16).padStart(2, '0')).join('');
}

async function hmacSha256(key, message) {
  const encoder = new TextEncoder();
  const keyData = encoder.encode(key);
  const msgData = encoder.encode(message);
  const cryptoKey = await crypto.subtle.importKey('raw', keyData, { name: 'HMAC', hash: 'SHA-256' }, false, ['sign']);
  const sig = await crypto.subtle.sign('HMAC', cryptoKey, msgData);
  return Array.from(new Uint8Array(sig), b => b.toString(16).padStart(2, '0')).join('');
}

// Provably fair state
let pfState = {
  clientSeed: '',
  serverSeed: '',
  serverSeedHash: '',
  nonce: 0
};

async function initProvablyFair() {
  const saved = localStorage.getItem('spunkbet_pf');
  if (saved) {
    try { pfState = JSON.parse(saved); } catch(e) {}
  }
  if (!pfState.clientSeed) {
    pfState.clientSeed = generateRandomHex(16);
  }
  if (!pfState.serverSeed) {
    await rotateServerSeed();
  }
  savePFState();
  updatePFDisplay();
}

async function rotateServerSeed() {
  pfState.serverSeed = generateRandomHex(32);
  pfState.serverSeedHash = await sha256(pfState.serverSeed);
}

function savePFState() {
  localStorage.setItem('spunkbet_pf', JSON.stringify(pfState));
}

async function rotateClientSeed() {
  pfState.clientSeed = generateRandomHex(16);
  pfState.nonce = 0;
  await rotateServerSeed();
  savePFState();
  updatePFDisplay();
  showToast('Client seed rotated. Server seed reset.');
}

function updatePFDisplay() {
  const cs = document.getElementById('my-client-seed');
  const sh = document.getElementById('my-server-hash');
  const nc = document.getElementById('my-nonce');
  if (cs) cs.value = pfState.clientSeed;
  if (sh) sh.value = pfState.serverSeedHash;
  if (nc) nc.value = pfState.nonce;
}

// Get a provably fair random number between 0 and 1
async function fairRandom() {
  const hash = await hmacSha256(pfState.serverSeed, pfState.clientSeed + ':' + pfState.nonce);
  pfState.nonce++;
  // Use first 8 hex chars = 4 bytes = 32 bits
  const num = parseInt(hash.substring(0, 8), 16);
  return num / 0x100000000; // 0 to 0.999...
}

// Show seed info on a game's seed display element
async function showGameSeed(elementId, serverSeed, serverSeedHash) {
  const el = document.getElementById(elementId);
  if (!el) return;
  el.innerHTML = 'Seed hash: ' + serverSeedHash.substring(0, 16) + '... | Server seed: ' + serverSeed.substring(0, 8) + '... <span style="color:var(--accent)">(click to copy full data)</span>';
  el.dataset.fullSeed = JSON.stringify({ serverSeed, serverSeedHash, clientSeed: pfState.clientSeed, nonce: pfState.nonce - 1 });
}

function copySeed(elementId) {
  const el = document.getElementById(elementId);
  if (!el || !el.dataset.fullSeed) return;
  navigator.clipboard.writeText(el.dataset.fullSeed).then(() => {
    showToast('Seed data copied! Paste into Provably Fair verifier.');
  });
}

async function verifyBet() {
  const server = document.getElementById('verify-server').value.trim();
  const hash = document.getElementById('verify-hash').value.trim();
  const client = document.getElementById('verify-client').value.trim();
  const nonce = document.getElementById('verify-nonce').value.trim();
  const resultEl = document.getElementById('verify-result');

  if (!server || !hash) {
    resultEl.className = 'verify-result fail';
    resultEl.textContent = 'Please enter server seed and hash.';
    return;
  }

  const computedHash = await sha256(server);
  if (computedHash === hash) {
    let extra = '';
    if (client) {
      const hmac = await hmacSha256(server, client + ':' + nonce);
      const num = parseInt(hmac.substring(0, 8), 16) / 0x100000000;
      extra = ' | Outcome value: ' + num.toFixed(8) + ' (HMAC: ' + hmac.substring(0, 16) + '...)';
    }
    resultEl.className = 'verify-result pass';
    resultEl.textContent = 'VERIFIED: Server seed matches the committed hash.' + extra;
  } else {
    resultEl.className = 'verify-result fail';
    resultEl.textContent = 'FAILED: Hash mismatch. Expected ' + computedHash.substring(0, 16) + '... but got ' + hash.substring(0, 16) + '...';
  }
}

// ===== STATE =====
let balance = 0;
let history = [];
let cfSide = 'heads';

// ===== REFERRAL TIER CONFIG =====
const TIERS = [
  { name: 'Starter', min: 0, reward: 500, css: 'starter' },
  { name: 'Bronze', min: 3, reward: 500, css: 'bronze' },
  { name: 'Silver', min: 5, reward: 750, css: 'silver' },
  { name: 'Gold', min: 10, reward: 1000, css: 'gold' },
  { name: 'VIP', min: 25, reward: 1500, css: 'vip' },
];

function getTier(count) {
  let tier = TIERS[0];
  for (const t of TIERS) {
    if (count >= t.min) tier = t;
  }
  return tier;
}

function getTierReward(referrerCount) {
  const totalReferrers = getTotalReferrerCount();
  const tier = getTier(referrerCount);
  const isFirst100 = totalReferrers <= 100;
  return isFirst100 ? tier.reward * 2 : tier.reward;
}

function getTotalReferrerCount() {
  let ledger = {};
  try { ledger = JSON.parse(localStorage.getItem('spunkbet_referral_ledger') || '{}'); } catch(e) {}
  return Object.keys(ledger).length;
}

// ===== FAUCET =====
function canClaimFaucet() {
  const lastClaim = localStorage.getItem('spunkbet_faucet_time');
  if (!lastClaim) return true;
  const elapsed = Date.now() - parseInt(lastClaim);
  return elapsed > 24 * 60 * 60 * 1000; // 24 hours
}

function updateFaucetButton() {
  const btn = document.getElementById('faucet-btn');
  if (!btn) return;
  if (canClaimFaucet()) {
    btn.disabled = false;
    btn.textContent = 'Claim 10,000 SPUNK';
  } else {
    btn.disabled = true;
    const lastClaim = parseInt(localStorage.getItem('spunkbet_faucet_time'));
    const nextClaim = lastClaim + 24 * 60 * 60 * 1000;
    const remaining = nextClaim - Date.now();
    const hours = Math.floor(remaining / (60 * 60 * 1000));
    const mins = Math.floor((remaining % (60 * 60 * 1000)) / (60 * 1000));
    btn.textContent = 'Claim again in ' + hours + 'h ' + mins + 'm';
  }
}

function claimFaucet() {
  if (!canClaimFaucet()) return;
  balance += 10000;
  localStorage.setItem('spunkbet_faucet_time', Date.now().toString());
  updateBalance();
  saveState();
  updateFaucetButton();
  showToast('Claimed <span class="toast-amount">10,000 SPUNK</span>! Go play some games.');
  // Also send real runes on-chain if wallet is connected
  if (walletState.connected) {
    claimFaucetOnChain();
  }
}

// ===== LOCALSTORAGE PERSISTENCE =====
function saveState() {
  localStorage.setItem('spunkbet_balance', balance.toString());
  localStorage.setItem('spunkbet_history', JSON.stringify(history));
  if (walletState.connected) {
    localStorage.setItem('spunkbet_wallet', JSON.stringify(walletState));
  }
}

function loadState() {
  const savedBalance = localStorage.getItem('spunkbet_balance');
  if (savedBalance !== null) balance = parseInt(savedBalance) || 0;

  const savedHistory = localStorage.getItem('spunkbet_history');
  if (savedHistory) {
    try { history = JSON.parse(savedHistory); } catch(e) { history = []; }
  }

  const savedWallet = localStorage.getItem('spunkbet_wallet');
  if (savedWallet) {
    try {
      const w = JSON.parse(savedWallet);
      if (w.connected) {
        walletState = w;
        updateWalletButton();
        updateShareButton();
      }
    } catch(e) {}
  }

  updateBalance();
  renderHistory();
  updateFirst100();
  renderLeaderboard();
  updateFaucetButton();
}

// ===== REFERRAL CAPTURE =====
function captureReferral() {
  const params = new URLSearchParams(window.location.search);
  const ref = params.get('ref');
  if (ref && ref.length >= 6) {
    if (!localStorage.getItem('spunkbet_referrer')) {
      localStorage.setItem('spunkbet_referrer', ref);
    }
  }
}

// ===== REFERRAL TRACKING =====
function processReferralOnConnect(address) {
  const claimKey = 'spunkbet_claimed_' + address;
  if (localStorage.getItem(claimKey)) return;

  const referrer = localStorage.getItem('spunkbet_referrer');
  const selfRef = address.slice(0, 8);
  const isReferred = referrer && referrer !== selfRef;

  localStorage.setItem(claimKey, Date.now().toString());

  if (isReferred) {
    trackReferral(referrer, address);
    showToast('Welcome! You were referred by <span class="toast-amount">' + referrer + '</span>. Share your own link to earn SPUNK!');
    // Send on-chain referral reward to the referrer
    claimReferralOnChain(address);
  } else {
    showToast('Welcome to <span class="toast-amount">Spunk.bet</span>! Share your referral link to earn SPUNK.');
  }

  updateFirst100();
  renderLeaderboard();
  saveState();
}

function trackReferral(referrerCode, newAddress) {
  let ledger = {};
  try { ledger = JSON.parse(localStorage.getItem('spunkbet_referral_ledger') || '{}'); } catch(e) {}
  if (!ledger[referrerCode]) ledger[referrerCode] = [];
  if (ledger[referrerCode].some(e => e.address === newAddress)) return;
  ledger[referrerCode].push({ address: newAddress, time: Date.now() });
  localStorage.setItem('spunkbet_referral_ledger', JSON.stringify(ledger));
}

function getReferralCount() {
  if (!walletState.connected) return 0;
  const code = walletState.paymentAddress.slice(0, 8);
  let ledger = {};
  try { ledger = JSON.parse(localStorage.getItem('spunkbet_referral_ledger') || '{}'); } catch(e) {}
  return (ledger[code] || []).length;
}

function getReferralEarnings() {
  const count = getReferralCount();
  if (count === 0) return 0;
  let total = 0;
  const tier = getTier(count);
  total = tier.reward * count;
  const totalReferrers = getTotalReferrerCount();
  if (totalReferrers <= 100) total *= 2;
  return total;
}

// ===== FIRST 100 REFERRERS =====
function updateFirst100() {
  const total = getTotalReferrerCount();
  const remaining = Math.max(0, 100 - total);
  const el = document.getElementById('first100-count');
  if (el) el.textContent = remaining;
  const banner = document.getElementById('first100-banner');
  if (banner) banner.style.display = remaining > 0 ? '' : 'none';
}

// ===== LEADERBOARD =====
function renderLeaderboard() {
  let ledger = {};
  try { ledger = JSON.parse(localStorage.getItem('spunkbet_referral_ledger') || '{}'); } catch(e) {}

  const entries = Object.entries(ledger)
    .map(([code, refs]) => ({ code, count: refs.length }))
    .sort((a, b) => b.count - a.count)
    .slice(0, 10);

  const listEl = document.getElementById('leaderboard-list');
  if (!listEl) return;

  if (entries.length === 0) {
    listEl.innerHTML = '<div class="leaderboard-empty">No referrals yet. Be the first!</div>';
  } else {
    listEl.innerHTML = entries.map((e, i) => {
      const rankClass = i < 3 ? 'r' + (i + 1) : 'r4';
      const tier = getTier(e.count);
      return '<div class="leaderboard-entry">' +
        '<div class="leaderboard-rank ' + rankClass + '">' + (i + 1) + '</div>' +
        '<div class="leaderboard-addr">' + e.code + '...</div>' +
        '<span class="tier-badge ' + tier.css + '">' + tier.name + '</span>' +
        '<div class="leaderboard-count">' + e.count + ' refs</div>' +
      '</div>';
    }).join('');
  }

  renderTierCards('leaderboard-tiers', -1);
}

function renderTierCards(containerId, activeCount) {
  const el = document.getElementById(containerId);
  if (!el) return;
  el.innerHTML = TIERS.slice(1).map(t => {
    const isActive = activeCount >= t.min;
    const colorVar = t.css === 'gold' ? 'gold' : t.css === 'vip' ? 'purple' : t.css === 'silver' ? 'muted' : t.css === 'bronze' ? 'yellow' : 'muted';
    return '<div class="tier-card ' + (isActive ? 'active' : '') + '">' +
      '<div class="tier-name" style="color:var(--' + colorVar + ')">' + t.name + '</div>' +
      '<div class="tier-req">' + t.min + '+ refs</div>' +
      '<div class="tier-reward">+' + t.reward + '/ref</div>' +
    '</div>';
  }).join('');
}

// ===== TOAST =====
function showToast(html) {
  const toast = document.getElementById('welcome-toast');
  toast.innerHTML = html;
  setTimeout(() => toast.classList.add('show'), 50);
  setTimeout(() => toast.classList.remove('show'), 4500);
}

// ===== MOBILE MENU =====
function toggleMobileMenu() {
  const menu = document.getElementById('mobile-menu');
  const btn = document.getElementById('hamburger-btn');
  menu.classList.toggle('show');
  btn.classList.toggle('open');
}

// ===== NAVIGATION =====
function showPage(id) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  if (id === 'home') document.querySelectorAll('.nav-tab')[0].classList.add('active');
  if (id === 'leaderboard-page') document.querySelectorAll('.nav-tab')[1].classList.add('active');
  if (id === 'history-page') document.querySelectorAll('.nav-tab')[2].classList.add('active');
  if (id === 'wallets-page') document.querySelectorAll('.nav-tab')[3].classList.add('active');
  if (id === 'fair-page') document.querySelectorAll('.nav-tab')[4].classList.add('active');
  if (id === 'leaderboard-page') renderLeaderboard();
  if (id === 'fair-page') updatePFDisplay();
  window.scrollTo(0, 0);
}

function openGame(id) {
  showPage(id);
  if (id === 'dice') updateDiceSlider();
  if (id === 'mines') initMinesGrid();
}

// ===== BALANCE =====
function updateBalance() {
  document.getElementById('balance-display').textContent = balance.toLocaleString();
}

const MIN_BET = 100;

function getBet(id) {
  const v = parseInt(document.getElementById(id).value) || 0;
  if (v < MIN_BET) {
    showToast('Minimum bet is <span class="toast-amount">' + MIN_BET + ' SPUNK</span>');
    return 0;
  }
  return Math.min(v, balance);
}

function setBet(id, action) {
  const el = document.getElementById(id);
  let v = parseInt(el.value) || 100;
  if (action === 'half') v = Math.max(MIN_BET, Math.floor(v / 2));
  if (action === 'double') v = Math.min(balance, v * 2);
  if (action === 'max') v = balance;
  el.value = v;
}

function addHistory(game, bet, result, amount, seedData) {
  history.unshift({ game, bet, result, amount, time: new Date(), seed: seedData || null });
  if (history.length > 50) history.pop();
  renderHistory();
  saveState();
}

function renderHistory() {
  const el = document.getElementById('history-full-list');
  if (history.length === 0) {
    el.innerHTML = '<div style="color:var(--muted);text-align:center;padding:2rem;">No bets yet.</div>';
    return;
  }
  el.innerHTML = history.map(h => {
    const isWin = h.result === 'win';
    const seedBtn = h.seed ? ' <span style="color:var(--accent);cursor:pointer;font-size:0.7rem;" onclick=\'navigator.clipboard.writeText(JSON.stringify(' + JSON.stringify(h.seed).replace(/'/g, "\\'") + '))\'>[copy seed]</span>' : '';
    return '<div class="history-item">' +
      '<span class="history-game">' + h.game + seedBtn + '</span>' +
      '<span>' + h.bet + ' SPUNK</span>' +
      '<span class="history-result ' + h.result + '">' + (isWin ? '+' : '-') + Math.abs(h.amount).toLocaleString() + ' SPUNK</span>' +
    '</div>';
  }).join('');
}

function showResult(id, win, msg) {
  const el = document.getElementById(id);
  el.className = 'result ' + (win ? 'win' : 'lose');
  el.textContent = msg;
}

// ===== COIN FLIP =====
function pickSide(side) {
  cfSide = side;
  document.getElementById('cf-heads').classList.toggle('selected', side === 'heads');
  document.getElementById('cf-tails').classList.toggle('selected', side === 'tails');
}

async function flipCoin() {
  const bet = getBet('cf-bet');
  if (bet <= 0 || bet > balance) return;
  balance -= bet;
  updateBalance();

  // Capture current seed for this bet
  const seedBefore = { serverSeedHash: pfState.serverSeedHash, clientSeed: pfState.clientSeed, nonce: pfState.nonce };

  const coin = document.getElementById('cf-coin');
  coin.className = 'coin flipping';
  coin.textContent = '?';

  const rand = await fairRandom();
  const seedAfter = { ...seedBefore, serverSeed: pfState.serverSeed };

  // Rotate server seed for next game
  await rotateServerSeed();
  savePFState();

  setTimeout(() => {
    const result = rand < 0.5 ? 'heads' : 'tails';
    const win = result === cfSide;
    coin.className = 'coin ' + result;
    coin.textContent = result === 'heads' ? 'H' : 'T';

    showGameSeed('cf-seed', seedAfter.serverSeed, seedAfter.serverSeedHash);

    if (win) {
      const payout = Math.floor(bet * 1.98);
      balance += payout;
      showResult('cf-result', true, result.toUpperCase() + '! You won +' + (payout - bet).toLocaleString() + ' SPUNK');
      addHistory('Coin Flip', bet, 'win', payout - bet, seedAfter);
    } else {
      showResult('cf-result', false, result.toUpperCase() + '. You lost ' + bet.toLocaleString() + ' SPUNK');
      addHistory('Coin Flip', bet, 'lose', -bet, seedAfter);
    }
    updateBalance();
    saveState();
  }, 650);
}

// ===== DICE =====
function updateDiceSlider() {
  const slider = document.getElementById('dice-slider');
  const val = parseInt(slider.value);
  slider.style.setProperty('--val', val + '%');
  document.getElementById('dice-target-val').textContent = val;
  const chance = val - 1;
  document.getElementById('dice-chance').textContent = chance + '%';
  const payout = chance > 0 ? (98 / chance).toFixed(2) : '0.00';
  document.getElementById('dice-payout').textContent = payout + 'x';
}

async function rollDice() {
  const bet = getBet('dice-bet');
  if (bet > balance || bet <= 0) return;
  const target = parseInt(document.getElementById('dice-slider').value);
  balance -= bet;
  updateBalance();

  const seedBefore = { serverSeedHash: pfState.serverSeedHash, clientSeed: pfState.clientSeed, nonce: pfState.nonce };
  const rand = await fairRandom();
  const seedAfter = { ...seedBefore, serverSeed: pfState.serverSeed };
  await rotateServerSeed();
  savePFState();

  const die = document.getElementById('dice-die');
  die.className = 'die rolling';
  die.textContent = '?';

  setTimeout(() => {
    const roll = Math.floor(rand * 100) + 1;
    const win = roll < target;
    die.className = 'die ' + (win ? 'hit' : 'miss');
    die.textContent = roll;
    const chance = target - 1;
    const multi = chance > 0 ? (98 / chance) : 0;

    showGameSeed('dice-seed', seedAfter.serverSeed, seedAfter.serverSeedHash);

    if (win) {
      const payout = Math.floor(bet * multi);
      balance += payout;
      showResult('dice-result', true, 'Rolled ' + roll + ' (under ' + target + '). Won +' + (payout - bet).toLocaleString() + ' SPUNK');
      addHistory('Dice', bet, 'win', payout - bet, seedAfter);
    } else {
      showResult('dice-result', false, 'Rolled ' + roll + ' (needed under ' + target + '). Lost ' + bet.toLocaleString() + ' SPUNK');
      addHistory('Dice', bet, 'lose', -bet, seedAfter);
    }
    updateBalance();
    saveState();
  }, 450);
}

// ===== MINES =====
let minesState = null;

function changeMines(d) {
  const el = document.getElementById('mines-count');
  let v = parseInt(el.textContent) + d;
  v = Math.min(24, Math.max(1, v));
  el.textContent = v;
}

function initMinesGrid() {
  const grid = document.getElementById('mines-grid');
  grid.innerHTML = '';
  for (let i = 0; i < 25; i++) {
    const cell = document.createElement('div');
    cell.className = 'mine-cell';
    cell.textContent = '';
    cell.dataset.index = i;
    grid.appendChild(cell);
  }
  document.getElementById('mines-revealed').textContent = '0';
  document.getElementById('mines-multi').textContent = '1.00x';
  document.getElementById('mines-profit').textContent = '+0';
  document.getElementById('mines-result').className = 'result';
  document.getElementById('mines-start-btn').style.display = '';
  document.getElementById('mines-cashout-btn').style.display = 'none';
  minesState = null;
}

function getMinesMulti(revealed, mineCount) {
  let multi = 1;
  for (let i = 0; i < revealed; i++) {
    multi *= (25 - mineCount - i) > 0 ? (25 - i) / (25 - mineCount - i) : 1;
  }
  return multi * 0.98;
}

async function startMines() {
  const bet = getBet('mines-bet');
  if (bet > balance || bet <= 0) return;
  const mineCount = parseInt(document.getElementById('mines-count').textContent);
  balance -= bet;
  updateBalance();
  saveState();
  initMinesGrid();

  const seedBefore = { serverSeedHash: pfState.serverSeedHash, clientSeed: pfState.clientSeed, nonce: pfState.nonce };

  // Generate mine positions using provably fair randomness
  const positions = [];
  const available = Array.from({length: 25}, (_, i) => i);
  for (let i = 0; i < mineCount; i++) {
    const rand = await fairRandom();
    const idx = Math.floor(rand * available.length);
    positions.push(available[idx]);
    available.splice(idx, 1);
  }

  const seedAfter = { ...seedBefore, serverSeed: pfState.serverSeed, nonces: pfState.nonce - 1 };
  await rotateServerSeed();
  savePFState();

  minesState = { bet, mineCount, mines: positions, revealed: 0, active: true, seedData: seedAfter };
  document.getElementById('mines-start-btn').style.display = 'none';
  document.getElementById('mines-cashout-btn').style.display = '';
  showGameSeed('mines-seed', seedAfter.serverSeed, seedAfter.serverSeedHash);

  document.querySelectorAll('.mine-cell').forEach(cell => {
    cell.onclick = () => revealMine(parseInt(cell.dataset.index));
  });
}

function revealMine(index) {
  if (!minesState || !minesState.active) return;
  const cell = document.querySelectorAll('.mine-cell')[index];
  if (cell.classList.contains('revealed')) return;
  if (minesState.mines.includes(index)) {
    cell.classList.add('revealed', 'bomb');
    cell.textContent = '\u{1F4A5}';
    minesState.active = false;
    minesState.mines.forEach(m => {
      const c = document.querySelectorAll('.mine-cell')[m];
      if (!c.classList.contains('revealed')) { c.classList.add('revealed', 'shown'); c.textContent = '\u{1F4A3}'; }
    });
    showResult('mines-result', false, 'BOOM! Lost ' + minesState.bet.toLocaleString() + ' SPUNK');
    addHistory('Mines', minesState.bet, 'lose', -minesState.bet, minesState.seedData);
    document.getElementById('mines-cashout-btn').style.display = 'none';
    document.getElementById('mines-start-btn').style.display = '';
  } else {
    cell.classList.add('revealed', 'safe');
    cell.textContent = '\u{1F48E}';
    minesState.revealed++;
    const multi = getMinesMulti(minesState.revealed, minesState.mineCount);
    const profit = Math.floor(minesState.bet * multi) - minesState.bet;
    document.getElementById('mines-revealed').textContent = minesState.revealed;
    document.getElementById('mines-multi').textContent = multi.toFixed(2) + 'x';
    document.getElementById('mines-profit').textContent = '+' + profit.toLocaleString();
    if (minesState.revealed >= 25 - minesState.mineCount) cashoutMines();
  }
}

function cashoutMines() {
  if (!minesState || !minesState.active) return;
  minesState.active = false;
  const multi = getMinesMulti(minesState.revealed, minesState.mineCount);
  const payout = Math.floor(minesState.bet * multi);
  balance += payout;
  updateBalance();
  const profit = payout - minesState.bet;
  showResult('mines-result', true, 'Cashed out at ' + multi.toFixed(2) + 'x! Won +' + profit.toLocaleString() + ' SPUNK');
  addHistory('Mines', minesState.bet, 'win', profit, minesState.seedData);
  minesState.mines.forEach(m => {
    const c = document.querySelectorAll('.mine-cell')[m];
    c.classList.add('revealed', 'shown'); c.textContent = '\u{1F4A3}';
  });
  document.getElementById('mines-cashout-btn').style.display = 'none';
  document.getElementById('mines-start-btn').style.display = '';
  saveState();
}

// ===== CRASH =====
let crashState = null;

async function startCrash() {
  const bet = getBet('crash-bet');
  if (bet > balance || bet <= 0) return;
  balance -= bet;
  updateBalance();
  saveState();

  const seedBefore = { serverSeedHash: pfState.serverSeedHash, clientSeed: pfState.clientSeed, nonce: pfState.nonce };
  const rand = await fairRandom();
  const seedAfter = { ...seedBefore, serverSeed: pfState.serverSeed };
  await rotateServerSeed();
  savePFState();

  const crashAt = Math.max(1, (0.97 / (1 - rand)));
  crashState = { bet, crashAt, multi: 1.00, active: true, cashed: false, startTime: Date.now(), seedData: seedAfter };
  document.getElementById('crash-start-btn').style.display = 'none';
  document.getElementById('crash-cashout-btn').style.display = '';
  document.getElementById('crash-result').className = 'result';
  document.getElementById('crash-multi').className = 'crash-multi live';
  document.getElementById('crash-status').textContent = 'Rising...';
  showGameSeed('crash-seed', seedAfter.serverSeed, seedAfter.serverSeedHash);

  const canvas = document.getElementById('crash-canvas');
  const ctx = canvas.getContext('2d');
  canvas.width = canvas.offsetWidth * 2;
  canvas.height = canvas.offsetHeight * 2;
  ctx.scale(2, 2);
  animateCrash(ctx, canvas);
}

function animateCrash(ctx, canvas) {
  if (!crashState) return;
  const w = canvas.width / 2, h = canvas.height / 2;
  const elapsed = (Date.now() - crashState.startTime) / 1000;
  const multi = Math.pow(Math.E, elapsed * 0.5);
  crashState.multi = Math.round(multi * 100) / 100;
  document.getElementById('crash-multi').textContent = crashState.multi.toFixed(2) + 'x';
  ctx.clearRect(0, 0, w, h);
  ctx.strokeStyle = crashState.cashed ? '#ff5f1f' : '#22c55e';
  ctx.lineWidth = 2;
  ctx.beginPath();
  const points = 100;
  for (let i = 0; i <= points; i++) {
    const t = (elapsed * i) / points;
    const m = Math.pow(Math.E, t * 0.5);
    const x = (i / points) * w;
    const maxM = Math.max(crashState.multi, 2);
    const y = h - ((m - 1) / (maxM - 1)) * (h - 20);
    if (i === 0) ctx.moveTo(x, Math.min(y, h));
    else ctx.lineTo(x, Math.min(y, h));
  }
  ctx.stroke();
  if (crashState.multi >= crashState.crashAt && !crashState.cashed) {
    crashState.active = false;
    document.getElementById('crash-multi').className = 'crash-multi crashed';
    document.getElementById('crash-multi').textContent = crashState.crashAt.toFixed(2) + 'x';
    document.getElementById('crash-status').textContent = 'Crashed!';
    document.getElementById('crash-cashout-btn').style.display = 'none';
    document.getElementById('crash-start-btn').style.display = '';
    showResult('crash-result', false, 'Crashed at ' + crashState.crashAt.toFixed(2) + 'x. Lost ' + crashState.bet.toLocaleString() + ' SPUNK');
    addHistory('Crash', crashState.bet, 'lose', -crashState.bet, crashState.seedData);
    return;
  }
  if (crashState.cashed) return;
  requestAnimationFrame(() => animateCrash(ctx, canvas));
}

function cashoutCrash() {
  if (!crashState || !crashState.active) return;
  crashState.active = false;
  crashState.cashed = true;
  const payout = Math.floor(crashState.bet * crashState.multi);
  balance += payout;
  updateBalance();
  const profit = payout - crashState.bet;
  document.getElementById('crash-multi').className = 'crash-multi cashed';
  document.getElementById('crash-status').textContent = 'Cashed out at ' + crashState.multi.toFixed(2) + 'x';
  document.getElementById('crash-cashout-btn').style.display = 'none';
  document.getElementById('crash-start-btn').style.display = '';
  showResult('crash-result', true, 'Cashed at ' + crashState.multi.toFixed(2) + 'x! Won +' + profit.toLocaleString() + ' SPUNK');
  addHistory('Crash', crashState.bet, 'win', profit, crashState.seedData);
  saveState();
}

// ===== XVERSE WALLET =====
let walletState = { connected: false, paymentAddress: null, ordinalsAddress: null };

function handleWalletClick() {
  if (walletState.connected) {
    showWalletDetails();
  } else {
    document.getElementById('wallet-modal').classList.add('show');
    document.getElementById('wallet-install-hint').style.display = 'none';
    document.getElementById('wallet-install-text').innerHTML = '';
  }
}

function closeWalletModal() { document.getElementById('wallet-modal').classList.remove('show'); }
function closeWalletDetails() { document.getElementById('wallet-details-modal').classList.remove('show'); }

function showWalletDetails() {
  const el = document.getElementById('wallet-info-details');
  const shortAddr = (a) => a ? a.slice(0, 8) + '...' + a.slice(-6) : 'N/A';
  el.innerHTML =
    '<div class="wallet-info-row"><span class="wallet-info-label">Payment</span><span class="wallet-info-value">' + shortAddr(walletState.paymentAddress) + '</span></div>' +
    '<div class="wallet-info-row"><span class="wallet-info-label">Ordinals</span><span class="wallet-info-value">' + shortAddr(walletState.ordinalsAddress) + '</span></div>' +
    '<div class="wallet-info-row"><span class="wallet-info-label">Network</span><span class="wallet-info-value">Mainnet</span></div>';

  const count = getReferralCount();
  const tier = getTier(count);
  document.getElementById('wallet-tier-display').innerHTML =
    '<div style="display:flex;justify-content:space-between;align-items:center;font-size:0.85rem;">' +
      '<span style="color:var(--muted);">Referral Tier</span>' +
      '<span class="tier-badge ' + tier.css + '">' + tier.name + '</span>' +
    '</div>' +
    '<div style="display:flex;justify-content:space-between;align-items:center;font-size:0.85rem;margin-top:0.3rem;">' +
      '<span style="color:var(--muted);">Referrals</span>' +
      '<span style="font-weight:700;color:var(--accent);">' + count + '</span>' +
    '</div>';
  document.getElementById('wallet-details-modal').classList.add('show');
}

function updateWalletButton() {
  const btn = document.getElementById('wallet-btn');
  if (walletState.connected) {
    const short = walletState.paymentAddress.slice(0, 6) + '...' + walletState.paymentAddress.slice(-4);
    btn.className = 'wallet-btn connected';
    btn.innerHTML = '<div class="wallet-dot"></div>' + short;
  } else {
    btn.className = 'wallet-btn';
    btn.textContent = 'Connect Wallet';
  }
}

function updateShareButton() {
  document.getElementById('share-btn').classList.toggle('visible', walletState.connected);
  const mobileShare = document.getElementById('mobile-share-btn');
  if (mobileShare) mobileShare.style.display = walletState.connected ? '' : 'none';
}

function disconnectWallet() {
  walletState = { connected: false, paymentAddress: null, ordinalsAddress: null };
  localStorage.removeItem('spunkbet_wallet');
  updateWalletButton();
  updateShareButton();
  closeWalletDetails();
}

function onWalletConnected() {
  updateWalletButton();
  updateShareButton();
  closeWalletModal();
  saveState();
  processReferralOnConnect(walletState.paymentAddress);
}

function getXverseProvider() {
  if (window.XverseProviders?.BitcoinProvider) return window.XverseProviders.BitcoinProvider;
  if (window.BitcoinProvider) return window.BitcoinProvider;
  if (window.btc_providers) {
    const xverse = window.btc_providers.find(p =>
      p.id === 'BitcoinProvider' || p.id === 'xverseProviders.BitcoinProvider'
    );
    if (xverse) return xverse.id.split('.').reduce((obj, key) => obj?.[key], window);
  }
  return null;
}

async function connectXverse() {
  const provider = getXverseProvider();
  if (!provider) { document.getElementById('wallet-install-hint').style.display = 'block'; return; }
  try {
    const connectResponse = await provider.request('wallet_connect', {
      addresses: ['payment', 'ordinals'],
      message: 'Spunk.bet wants to connect your wallet',
      network: 'Mainnet'
    });
    if (connectResponse.status === 'success') {
      const addresses = connectResponse.result.addresses || [];
      const payment = addresses.find(a => a.purpose === 'payment');
      const ordinals = addresses.find(a => a.purpose === 'ordinals');
      if (payment || addresses.length > 0) {
        walletState = { connected: true, paymentAddress: payment?.address || addresses[0]?.address, ordinalsAddress: ordinals?.address || null, provider: 'xverse' };
        onWalletConnected();
        return;
      }
    }
    const addrResponse = await provider.request('getAddresses', { purposes: ['payment', 'ordinals'] });
    if (addrResponse.status === 'success') {
      const addresses = addrResponse.result.addresses || addrResponse.result || [];
      const payment = addresses.find(a => a.purpose === 'payment');
      const ordinals = addresses.find(a => a.purpose === 'ordinals');
      walletState = { connected: true, paymentAddress: payment?.address || addresses[0]?.address, ordinalsAddress: ordinals?.address || null, provider: 'xverse' };
      onWalletConnected();
    }
  } catch (err) {
    if (err?.error?.code === -32000 || err?.code === 4001 || err?.error?.code === 4001) {
      closeWalletModal();
    } else {
      console.error('Xverse connection error:', err);
      document.getElementById('wallet-install-hint').style.display = 'block';
    }
  }
}

// ===== UNISAT WALLET =====
async function connectUnisat() {
  if (!window.unisat) {
    const hint = document.getElementById('wallet-install-hint');
    document.getElementById('wallet-install-text').innerHTML = 'Unisat not detected. <a href="https://unisat.io/download" target="_blank" style="color:var(--accent); text-decoration:none; font-weight:600;">Download Unisat</a> and refresh.';
    hint.style.display = 'block';
    return;
  }
  try {
    const accounts = await window.unisat.requestAccounts();
    if (accounts && accounts.length > 0) {
      walletState = {
        connected: true,
        paymentAddress: accounts[0],
        ordinalsAddress: accounts[0],
        provider: 'unisat'
      };
      onWalletConnected();
    }
  } catch (err) {
    if (err?.code === 4001) {
      closeWalletModal();
    } else {
      console.error('Unisat connection error:', err);
    }
  }
}

// ===== MAGIC EDEN WALLET =====
async function connectMagicEden() {
  const provider = window.magicEden?.bitcoin || window.MagicEden?.bitcoin;
  if (!provider) {
    const hint = document.getElementById('wallet-install-hint');
    document.getElementById('wallet-install-text').innerHTML = 'Magic Eden wallet not detected. <a href="https://wallet.magiceden.io/" target="_blank" style="color:var(--accent); text-decoration:none; font-weight:600;">Download Magic Eden Wallet</a> and refresh.';
    hint.style.display = 'block';
    return;
  }
  try {
    const accounts = await provider.connect();
    if (accounts && accounts.length > 0) {
      const payment = accounts.find(a => a.purpose === 'payment');
      const ordinals = accounts.find(a => a.purpose === 'ordinals');
      walletState = {
        connected: true,
        paymentAddress: payment?.address || accounts[0]?.address || accounts[0],
        ordinalsAddress: ordinals?.address || accounts[0]?.address || accounts[0],
        provider: 'magiceden'
      };
      onWalletConnected();
    }
  } catch (err) {
    if (err?.code === 4001) {
      closeWalletModal();
    } else {
      console.error('Magic Eden connection error:', err);
      // Try alternative API
      try {
        const res = await provider.requestAccounts();
        if (res && res.length > 0) {
          walletState = {
            connected: true,
            paymentAddress: res[0],
            ordinalsAddress: res[0],
            provider: 'magiceden'
          };
          onWalletConnected();
        }
      } catch (e2) {
        console.error('Magic Eden fallback error:', e2);
      }
    }
  }
}

// ===== PAYOUT API =====
const API_BASE = 'https://spunkbet-api.vercel.app';

async function claimFaucetOnChain() {
  if (!walletState.connected) return;
  try {
    const res = await fetch(API_BASE + '/api/claim', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ type: 'faucet', address: walletState.paymentAddress })
    });
    const data = await res.json();
    if (data.success) {
      showToast('Runes sent! TX: <span class="toast-amount">' + data.txid.slice(0, 12) + '...</span>');
    } else if (data.error) {
      showToast(data.error);
    }
  } catch (err) {
    console.error('Faucet claim error:', err);
  }
}

async function claimReferralOnChain(referrerAddress) {
  if (!walletState.connected) return;
  try {
    const res = await fetch(API_BASE + '/api/claim', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        type: 'referral',
        address: referrerAddress,
        referrerCode: walletState.paymentAddress.slice(0, 8),
        referredAddress: walletState.paymentAddress
      })
    });
    const data = await res.json();
    if (data.success) {
      showToast('Referral reward sent on-chain! TX: <span class="toast-amount">' + data.txid.slice(0, 12) + '...</span>');
    }
  } catch (err) {
    console.error('Referral claim error:', err);
  }
}

// ===== REFERRAL MODAL =====
function openReferralModal() {
  if (!walletState.connected) return;
  const code = walletState.paymentAddress.slice(0, 8);
  const link = window.location.origin + window.location.pathname + '?ref=' + code;
  document.getElementById('referral-link-input').value = link;
  document.getElementById('referral-code').textContent = code;
  const count = getReferralCount();
  document.getElementById('referral-count').textContent = count;
  const tier = getTier(count);
  document.getElementById('referral-tier').innerHTML = '<span class="tier-badge ' + tier.css + '">' + tier.name + '</span>';
  document.getElementById('referral-earned').textContent = getReferralEarnings().toLocaleString();
  renderTierCards('tiers-grid', count);
  document.getElementById('referral-modal').classList.add('show');
}

function closeReferralModal() { document.getElementById('referral-modal').classList.remove('show'); }

function copyReferralLink() {
  const input = document.getElementById('referral-link-input');
  navigator.clipboard.writeText(input.value).then(() => {
    const btn = input.nextElementSibling;
    btn.textContent = 'Copied!';
    setTimeout(() => { btn.textContent = 'Copy'; }, 1500);
  });
}

// ===== WALLET ADDRESS COPY =====
function copyWalletAddr(id) {
  const input = document.getElementById(id);
  navigator.clipboard.writeText(input.value).then(() => {
    const btn = input.nextElementSibling;
    btn.textContent = 'Copied!';
    setTimeout(() => { btn.textContent = 'Copy'; }, 1500);
  });
}

// Close modals on backdrop click
document.getElementById('wallet-modal').addEventListener('click', (e) => { if (e.target === e.currentTarget) closeWalletModal(); });
document.getElementById('wallet-details-modal').addEventListener('click', (e) => { if (e.target === e.currentTarget) closeWalletDetails(); });
document.getElementById('referral-modal').addEventListener('click', (e) => { if (e.target === e.currentTarget) closeReferralModal(); });

// Update faucet timer every minute
setInterval(updateFaucetButton, 60000);

// ===== INIT =====
captureReferral();
loadState();
updateDiceSlider();
initProvablyFair();
</script>
</body>
</html>
